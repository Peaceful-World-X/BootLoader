# BootLoader åµŒå…¥å¼å›ºä»¶å‡çº§å·¥å…·

[![Qt Version](https://img.shields.io/badge/Qt-6.8.1-green.svg)](https://www.qt.io/)
[![Language](https://img.shields.io/badge/language-C++-blue.svg)](https://isocpp.org/)
[![Platform](https://img.shields.io/badge/platform-Windows-lightgrey.svg)](https://www.microsoft.com/windows)
[![License](https://img.shields.io/badge/license-Proprietary-red.svg)](LICENSE)

åŸºäºŽ Qt 6.8.1 å¼€å‘çš„åµŒå…¥å¼å›ºä»¶å‡çº§å·¥å…·ï¼Œæ”¯æŒä¸²å£/ç½‘å£é€šä¿¡ï¼Œå¯å¯¹ FPGAã€DSPã€ARM ç­‰å¤šç§è®¾å¤‡è¿›è¡Œå›ºä»¶å‡çº§ã€‚

---

## é¡¹ç›®ç®€ä»‹

**BootLoader** æ˜¯ä¸€æ¬¾ä¸“ä¸šçš„åµŒå…¥å¼è®¾å¤‡å›ºä»¶å‡çº§å·¥å…·ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

- ðŸš€ æ”¯æŒ**ä¸²å£**å’Œ**ç½‘å£ï¼ˆTCPï¼‰**ä¸¤ç§é€šä¿¡æ–¹å¼
- ðŸ”§ åŒæ—¶æ”¯æŒ **FPGA**ã€**DSP1**ã€**DSP2**ã€**ARM** å››ç§è®¾å¤‡
- ðŸ“¦ å®Œæ•´çš„ **CRC16-MODBUS** æ ¡éªŒæœºåˆ¶
- ðŸ“ è¯¦ç»†çš„é€šä¿¡æ—¥å¿—è®°å½•
- ðŸŽ¯ å‹å¥½çš„å›¾å½¢åŒ–æ“ä½œç•Œé¢
- â±ï¸ æ™ºèƒ½è¶…æ—¶å’Œé”™è¯¯å¤„ç†

---

## é¡¹ç›®ç»“æž„

```
BootLoader/
â”œâ”€â”€ bin/                              # å¯æ‰§è¡Œæ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ BootLoader.exe                # ç¼–è¯‘åŽçš„å¯æ‰§è¡Œç¨‹åº
â”‚   â”œâ”€â”€ BootLoader ä½¿ç”¨è¯´æ˜Ž.md         # è½¯ä»¶ä½¿ç”¨æ‰‹å†Œ
â”‚   â””â”€â”€ bootloader.log                # è¿è¡Œæ—¥å¿—æ–‡ä»¶ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â”‚
â”œâ”€â”€ doc/                              # æ–‡æ¡£ç›®å½•
â”‚   â””â”€â”€ BootLoaderæµç¨‹åè®®è§£æž.md      # é€šä¿¡åè®®è¯¦ç»†è¯´æ˜Ž
â”‚
â”œâ”€â”€ gui/                              # ç•Œé¢è®¾è®¡æ–‡ä»¶
â”‚   â””â”€â”€ mainwindow.ui                 # Qt Designer UI æ–‡ä»¶
â”‚
â”œâ”€â”€ inc/                              # å¤´æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ communication.h               # é€šä¿¡ç®¡ç†å™¨ç±»
â”‚   â”œâ”€â”€ mainwindow.h                  # ä¸»çª—å£ç±»
â”‚   â”œâ”€â”€ protocol.h                    # åè®®è§£æžç±»
â”‚   â””â”€â”€ upgrade.h                     # å‡çº§ç®¡ç†å™¨ç±»
â”‚
â”œâ”€â”€ src/                              # æºæ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ communication.cpp             # ä¸²å£/TCP é€šä¿¡å®žçŽ°
â”‚   â”œâ”€â”€ main.cpp                      # ç¨‹åºå…¥å£ï¼ˆå«è¯•ç”¨æœŸéªŒè¯ï¼‰
â”‚   â”œâ”€â”€ mainwindow.cpp                # ä¸»çª—å£å®žçŽ°
â”‚   â”œâ”€â”€ protocol.cpp                  # åè®®ç¼–ç /è§£ç å®žçŽ°
â”‚   â””â”€â”€ upgrade.cpp                   # å‡çº§çŠ¶æ€æœºå®žçŽ°
â”‚
â”œâ”€â”€ test/                             # æµ‹è¯•å·¥å…·ç›®å½•
â”‚   â”œâ”€â”€ test_TCP.py                   # TCP ç½‘å£æµ‹è¯•æœåŠ¡å™¨ï¼ˆæ¨¡æ‹Ÿä¸‹ä½æœºï¼‰
â”‚   â””â”€â”€ test_COM.py                   # ä¸²å£æµ‹è¯•æœåŠ¡å™¨ï¼ˆæ¨¡æ‹Ÿä¸‹ä½æœºï¼‰
â”‚
â”œâ”€â”€ BootLoader.pro                    # Qt é¡¹ç›®æ–‡ä»¶
â”œâ”€â”€ README.md                         # é¡¹ç›®è¯´æ˜Žæ–‡æ¡£ï¼ˆæœ¬æ–‡ä»¶ï¼‰
â””â”€â”€ .gitignore                        # Git å¿½ç•¥é…ç½®

```

---

## æ ¸å¿ƒæ¨¡å—è¯´æ˜Ž

### 1. é€šä¿¡æ¨¡å— (`communication.cpp/h`)
è´Ÿè´£åº•å±‚ä¸²å£å’Œ TCP é€šä¿¡ï¼š
- **ä¸²å£é€šä¿¡**ï¼šåŸºäºŽ `QSerialPort`ï¼Œæ”¯æŒæ³¢ç‰¹çŽ‡ 115200
- **TCP é€šä¿¡**ï¼šåŸºäºŽ `QTcpSocket`ï¼Œé»˜è®¤ç«¯å£ 503
- **æ•°æ®æ”¶å‘**ï¼šå¼‚æ­¥è¯»å†™ï¼Œäº‹ä»¶é©±åŠ¨
- **é”™è¯¯å¤„ç†**ï¼šè¶…æ—¶æ£€æµ‹ã€è¿žæŽ¥æ–­å¼€å¤„ç†

### 2. åè®®æ¨¡å— (`protocol.cpp/h`)
å®žçŽ° BootLoader åè®®çš„ç¼–ç å’Œè§£æžï¼š
- **å¸§æž„å»º**ï¼šç»„è£…ç¬¦åˆåè®®çš„æ•°æ®å¸§
- **å¸§è§£æž**ï¼šè§£æžæŽ¥æ”¶åˆ°çš„æ•°æ®å¸§
- **CRC æ ¡éªŒ**ï¼šCRC16-MODBUS è®¡ç®—å’ŒéªŒè¯
- **ç±»åž‹æ˜ å°„**ï¼šæŠ¥æ–‡ç±»åž‹å’Œåº”ç­”æ ‡è¯†çš„å­—ç¬¦ä¸²æè¿°

### 3. å‡çº§ç®¡ç†æ¨¡å— (`upgrade.cpp/h`)
ç®¡ç†æ•´ä¸ªå‡çº§æµç¨‹çŠ¶æ€æœºï¼š
- **çŠ¶æ€ç®¡ç†**ï¼šIDLE â†’ REQUEST â†’ RESET â†’ UPGRADE â†’ END
- **è®¾å¤‡å¾ªçŽ¯**ï¼šFPGA â†’ DSP1 â†’ DSP2 â†’ ARM
- **æ•°æ®åˆ†åŒ…**ï¼šæ ¹æ®åŒ…å¤§å°è‡ªåŠ¨åˆ†åŒ…å‘é€
- **è¿›åº¦è·Ÿè¸ª**ï¼šå®žæ—¶æ›´æ–°è¿›åº¦ä¿¡æ¯
- **é”™è¯¯æ¢å¤**ï¼šè¶…æ—¶é‡è¯•ã€é”™è¯¯å¤„ç†

### 4. ä¸»çª—å£æ¨¡å— (`mainwindow.cpp/h`)
æä¾›ç”¨æˆ·äº¤äº’ç•Œé¢ï¼š
- **è¿žæŽ¥ç®¡ç†**ï¼šæ‰“å¼€/å…³é—­ä¸²å£æˆ– TCP è¿žæŽ¥
- **æ–‡ä»¶é€‰æ‹©**ï¼šé€‰æ‹©å„è®¾å¤‡çš„å›ºä»¶æ–‡ä»¶
- **å‚æ•°é…ç½®**ï¼šæ•°æ®åŒ…å¤§å°ã€è®¾å¤‡ ID ç­‰
- **æ—¥å¿—æ˜¾ç¤º**ï¼šå®žæ—¶æ˜¾ç¤ºå‡çº§è¿‡ç¨‹å’Œé€šä¿¡æ—¥å¿—

---

## ç¼–è¯‘å’Œæž„å»º

### å¼€å‘çŽ¯å¢ƒè¦æ±‚
- **Qt ç‰ˆæœ¬**ï¼š6.8.1 æˆ–æ›´é«˜
- **ç¼–è¯‘å™¨**ï¼šMinGW 64-bitï¼ˆWindowsï¼‰
- **IDE**ï¼šQt Creator 13.0+ æˆ– Visual Studio 2019+
- **CMake**ï¼š3.16+ ï¼ˆå¯é€‰ï¼‰

### ç¼–è¯‘æ­¥éª¤

#### æ–¹æ³•ä¸€ï¼šä½¿ç”¨ Qt Creator
1. æ‰“å¼€ Qt Creator
2. é€‰æ‹© `æ–‡ä»¶` â†’ `æ‰“å¼€æ–‡ä»¶æˆ–é¡¹ç›®`
3. é€‰æ‹© `BootLoader.pro`
4. é…ç½®ç¼–è¯‘å¥—ä»¶ï¼ˆKitï¼‰ä¸º Desktop Qt 6.8.1 MinGW 64-bit
5. é€‰æ‹© Release æ¨¡å¼
6. ç‚¹å‡» `æž„å»º` â†’ `æž„å»ºé¡¹ç›® "BootLoader"`
7. å¯æ‰§è¡Œæ–‡ä»¶ä½äºŽ `build/Desktop_Qt_6_8_1_MinGW_64_bit-Release/release/BootLoader.exe`

#### æ–¹æ³•äºŒï¼šå‘½ä»¤è¡Œç¼–è¯‘
```bash
cd BootLoader
qmake BootLoader.pro
mingw32-make release
```

### éƒ¨ç½²
å°†ç”Ÿæˆçš„ `BootLoader.exe` å¤åˆ¶åˆ° `bin/` ç›®å½•ï¼Œå¹¶ä½¿ç”¨ `windeployqt` å·¥å…·æ‰“åŒ…ä¾èµ–ï¼š
```bash
cd bin
windeployqt BootLoader.exe
```

---

## æµ‹è¯•æ–¹æ³•

é¡¹ç›®æä¾›äº†ä¸¤ä¸ª Python æµ‹è¯•è„šæœ¬ï¼Œç”¨äºŽæ¨¡æ‹Ÿä¸‹ä½æœºå“åº”ï¼Œä¾¿äºŽåœ¨æ²¡æœ‰å®žé™…ç¡¬ä»¶æ—¶è¿›è¡ŒåŠŸèƒ½æµ‹è¯•ã€‚

### æµ‹è¯•å·¥å…·è¯´æ˜Ž

#### 1. TCP ç½‘å£æµ‹è¯• (`test_TCP.py`)
æ¨¡æ‹Ÿé€šè¿‡ TCP ç½‘ç»œè¿žæŽ¥çš„ä¸‹ä½æœºã€‚

**åŠŸèƒ½**ï¼š
- ç›‘å¬ 503 ç«¯å£
- è§£æž BootLoader åè®®å¸§
- è‡ªåŠ¨å“åº”å‡çº§è¯·æ±‚ã€æ•°æ®æŽ¥æ”¶ç­‰
- æ˜¾ç¤ºè¯¦ç»†çš„é€šä¿¡æ—¥å¿—

**ä½¿ç”¨æ–¹æ³•**ï¼š
```bash
# è¿›å…¥æµ‹è¯•ç›®å½•
cd test

# ä½¿ç”¨é»˜è®¤ç«¯å£ 503
python test_TCP.py

# ä½¿ç”¨è‡ªå®šä¹‰ç«¯å£
python test_TCP.py 8080
```

#### 2. ä¸²å£æµ‹è¯• (`test_COM.py`)
æ¨¡æ‹Ÿé€šè¿‡ä¸²å£è¿žæŽ¥çš„ä¸‹ä½æœºã€‚

**åŠŸèƒ½**ï¼š
- æ‰“å¼€æŒ‡å®šä¸²å£
- è§£æžä¸²å£æŽ¥æ”¶çš„æ•°æ®å¸§
- è‡ªåŠ¨å“åº” BootLoader åè®®
- æ”¯æŒè™šæ‹Ÿä¸²å£å¯¹

**ä½¿ç”¨æ–¹æ³•**ï¼š
```bash
# è¿›å…¥æµ‹è¯•ç›®å½•
cd test

# åˆ—å‡ºå¯ç”¨ä¸²å£
python test_COM.py list

# ä½¿ç”¨é»˜è®¤é…ç½®ï¼ˆCOM3, 115200ï¼‰
python test_COM.py

# æŒ‡å®šä¸²å£
python test_COM.py COM1

# æŒ‡å®šä¸²å£å’Œæ³¢ç‰¹çŽ‡
python test_COM.py COM1 115200
```

**æ³¨æ„**ï¼šä¸²å£æµ‹è¯•éœ€è¦å®‰è£… `pyserial` åº“ï¼š
```bash
pip install pyserial
```

### å®Œæ•´æµ‹è¯•æµç¨‹

#### ç½‘å£æµ‹è¯•æµç¨‹

**æ­¥éª¤ 1ï¼šå¯åŠ¨æµ‹è¯•æœåŠ¡å™¨**
```bash
cd test
python test_TCP.py
```
çœ‹åˆ°ä»¥ä¸‹è¾“å‡ºè¡¨ç¤ºæœåŠ¡å™¨å¯åŠ¨æˆåŠŸï¼š
```
============================================================
BootLoaderæµ‹è¯•æœåŠ¡å™¨å·²å¯åŠ¨
ç›‘å¬ç«¯å£: 503
å¯åŠ¨æ—¶é—´: 2025-10-22 17:00:00
============================================================
ç­‰å¾…å®¢æˆ·ç«¯è¿žæŽ¥...
```

**æ­¥éª¤ 2ï¼šé…ç½® BootLoader å®¢æˆ·ç«¯**
1. å¯åŠ¨ `bin/BootLoader.exe`
2. é€‰æ‹©é“¾è·¯ï¼š**ç½‘å£**
3. IP åœ°å€ï¼š`127.0.0.1`ï¼ˆæœ¬æœºæµ‹è¯•ï¼‰æˆ– `192.168.1.100`
4. ç«¯å£ï¼š`503`
5. å‹¾é€‰éœ€è¦æµ‹è¯•çš„è®¾å¤‡ï¼ˆå¦‚ FPGAï¼‰
6. é€‰æ‹©ä»»æ„æµ‹è¯•æ–‡ä»¶ï¼ˆæˆ–åˆ›å»ºä¸€ä¸ªå°æ–‡ä»¶ï¼‰

**æ­¥éª¤ 3ï¼šæ‰§è¡Œæµ‹è¯•**
1. ç‚¹å‡» **"æ‰“å¼€é“¾è·¯"**ï¼Œè§‚å¯Ÿæµ‹è¯•æœåŠ¡å™¨è¾“å‡ºè¿žæŽ¥ä¿¡æ¯
2. ç‚¹å‡» **"å¼€å§‹å‡çº§"**
3. è§‚å¯Ÿå®¢æˆ·ç«¯ç•Œé¢å’ŒæœåŠ¡å™¨ç»ˆç«¯çš„æ—¥å¿—è¾“å‡º
4. éªŒè¯å‡çº§æµç¨‹æ˜¯å¦æ­£å¸¸å®Œæˆ

**é¢„æœŸç»“æžœ**ï¼š
- å®¢æˆ·ç«¯æ˜¾ç¤ºï¼š`>>> è¿žæŽ¥æˆåŠŸ` â†’ `>>> å¼€å§‹å‡çº§æµç¨‹` â†’ `>>> æ‰€æœ‰è®¾å¤‡å‡çº§å®Œæˆ`
- æœåŠ¡å™¨æ˜¾ç¤ºï¼šæŽ¥æ”¶å¸§ã€è§£æžæˆåŠŸã€å‘é€å“åº”ã€è¿›åº¦ç™¾åˆ†æ¯”

#### ä¸²å£æµ‹è¯•æµç¨‹ï¼ˆä½¿ç”¨è™šæ‹Ÿä¸²å£ï¼‰

**æ­¥éª¤ 1ï¼šå‡†å¤‡è™šæ‹Ÿä¸²å£**
- Windowsï¼šä½¿ç”¨ VSPD (Virtual Serial Port Driver) æˆ– com0com åˆ›å»ºè™šæ‹Ÿä¸²å£å¯¹ï¼ˆå¦‚ COM1â†”COM2ï¼‰
- Linuxï¼šä½¿ç”¨ `socat` åˆ›å»ºè™šæ‹Ÿä¸²å£

**æ­¥éª¤ 2ï¼šå¯åŠ¨æµ‹è¯•æœåŠ¡å™¨**
```bash
cd test
python test_COM.py COM1
```
è¾“å‡ºç¤ºä¾‹ï¼š
```
============================================================
BootLoaderä¸²å£æµ‹è¯•æœåŠ¡å™¨å·²å¯åŠ¨
ä¸²å£: COM1
æ³¢ç‰¹çŽ‡: 115200
å¯åŠ¨æ—¶é—´: 2025-10-22 17:05:00
============================================================
ç­‰å¾…æ•°æ®...
```

**æ­¥éª¤ 3ï¼šé…ç½®å®¢æˆ·ç«¯**
1. å¯åŠ¨ `BootLoader.exe`
2. é€‰æ‹©é“¾è·¯ï¼š**ä¸²å£**
3. å¯ç”¨ä¸²å£ï¼š`COM2`ï¼ˆä¸ŽæœåŠ¡å™¨é…å¯¹çš„å¦ä¸€ç«¯ï¼‰
4. ä»Žæœºæ¨¡å¼ï¼š`1`
5. é€‰æ‹©å›ºä»¶æ–‡ä»¶

**æ­¥éª¤ 4ï¼šæ‰§è¡Œæµ‹è¯•**
1. ç‚¹å‡» **"æ‰“å¼€é“¾è·¯"**
2. ç‚¹å‡» **"å¼€å§‹å‡çº§"**
3. è§‚å¯Ÿé€šä¿¡è¿‡ç¨‹

**é¢„æœŸç»“æžœ**ï¼š
- æ•°æ®æ­£ç¡®æ”¶å‘
- CRC æ ¡éªŒé€šè¿‡
- å‡çº§æµç¨‹å®Œæ•´

### æµ‹è¯•æœåŠ¡å™¨åŠŸèƒ½æ¼”ç¤º

æµ‹è¯•æœåŠ¡å™¨ä¼šæ¨¡æ‹Ÿä»¥ä¸‹ä¸‹ä½æœºè¡Œä¸ºï¼š

1. **å‡çº§è¯·æ±‚**ï¼šè¿”å›ž "å…è®¸å‡çº§"
2. **ç³»ç»Ÿå¤ä½**ï¼šå»¶è¿Ÿ 500ms åŽè¿”å›ž "é‡å¯æˆåŠŸ"
3. **å‡çº§æŒ‡ä»¤**ï¼š
   - è§£æžæ–‡ä»¶å¤§å°ã€åŒ…æ•°ã€CRC
   - å»¶è¿Ÿ 300ms æ¨¡æ‹Ÿ Flash æ“¦é™¤
   - è¿”å›ž "æ“¦é™¤FlashæˆåŠŸ"
4. **æ•°æ®åŒ…æŽ¥æ”¶**ï¼š
   - è§£æžåŒ…åºå·å’Œæ•°æ®
   - éªŒè¯åŒ…åºå·è¿žç»­æ€§
   - è¿”å›žæŽ¥æ”¶çŠ¶æ€ï¼ˆåŒ…åºå· + å·²æŽ¥æ”¶æ€»æ•°ï¼‰
   - æ¯ 10 åŒ…æ˜¾ç¤ºä¸€æ¬¡è¿›åº¦
5. **å‡çº§ç»“æŸ**ï¼šè¿”å›ž "æ‰€æœ‰æ•°æ®åŒ…å‘é€æˆåŠŸ"
6. **æ€»ä½“ç»“æŸ**ï¼šè¿”å›ž "å‘½ä»¤æ‰§è¡ŒæˆåŠŸ"

### æ—¥å¿—åˆ†æž

æµ‹è¯•æ—¶å¯å¯ç”¨æ—¥å¿—åŠŸèƒ½ï¼Œç”Ÿæˆçš„æ—¥å¿—æ ¼å¼å¦‚ä¸‹ï¼š
```
[2025-10-22 16:57:32] | TX | ID=01 | TYPE=å‘é€å‡çº§è¯·æ±‚             | FLAG=                                  | DATA=AA 55 01 00 0A 01 FE 0F A4 9C
[2025-10-22 16:57:32] | RX | ID=01 | TYPE=å‡çº§è¯·æ±‚                 | FLAG=å…è®¸å‡çº§                          | DATA=55 AA 01 00 0A 01 04 00 0B DE
```

**æ£€æŸ¥è¦ç‚¹**ï¼š
- âœ… TX å’Œ RX æˆå¯¹å‡ºçŽ°
- âœ… CRC æ ¡éªŒæ— é”™è¯¯
- âœ… FLAG çŠ¶æ€æ­£ç¡®ï¼ˆå…è®¸å‡çº§ã€æ“¦é™¤æˆåŠŸç­‰ï¼‰
- âœ… æ•°æ®åŒ…åºå·è¿žç»­
- âœ… æ— è¶…æ—¶æˆ–é‡ä¼ 

---

## åè®®è¯´æ˜Ž

è¯¦ç»†çš„é€šä¿¡åè®®è¯·å‚è€ƒï¼š[doc/BootLoaderæµç¨‹åè®®è§£æž.md](doc/BootLoaderæµç¨‹åè®®è§£æž.md)

### åè®®è¦ç‚¹
- **å¸§å¤´**ï¼šä¸Šä½æœº `0xAA 0x55`ï¼Œä¸‹ä½æœº `0x55 0xAA`
- **é•¿åº¦**ï¼šå¤§ç«¯åº 2 å­—èŠ‚ï¼Œè¡¨ç¤ºæ•´å¸§é•¿åº¦
- **æŠ¥æ–‡ç±»åž‹**ï¼šåŒºåˆ†è¯·æ±‚ã€æ•°æ®ã€ç»“æŸç­‰ä¸åŒé˜¶æ®µ
- **åº”ç­”æ ‡è¯†**ï¼šä¸Šä½æœºå›ºå®š `0xFE`ï¼Œä¸‹ä½æœºè¡¨ç¤ºæ‰§è¡ŒçŠ¶æ€
- **CRC**ï¼šCRC16-MODBUSï¼Œé«˜ä½åœ¨å‰

### å‡çº§æµç¨‹
```
ä¸Šä½æœº                                     ä¸‹ä½æœº
  |                                          |
  |--- 0x01 å‡çº§è¯·æ±‚ ----------------------->|
  |<-- 0x01 å…è®¸å‡çº§ (FLAG=0x04) ------------|
  |                                          |
  |--- 0x02 ç³»ç»Ÿå¤ä½ ----------------------->|
  |<-- 0x02 é‡å¯æˆåŠŸ (FLAG=0x0C) ------------|
  |                                          |
  |--- 0x06 FPGAå‡çº§æŒ‡ä»¤ -------------------->|
  |<-- 0x06 æ“¦é™¤FlashæˆåŠŸ (FLAG=0x0A) --------|
  |                                          |
  |--- 0x07 FPGAæ•°æ®åŒ… 1 -------------------->|
  |<-- 0x07 å‘½ä»¤æ‰§è¡ŒæˆåŠŸ (FLAG=0x00) ---------|
  |--- 0x07 FPGAæ•°æ®åŒ… 2 -------------------->|
  |<-- 0x07 å‘½ä»¤æ‰§è¡ŒæˆåŠŸ ---------------------|
  |    ... (å¾ªçŽ¯å‘é€æ‰€æœ‰æ•°æ®åŒ…)                |
  |                                          |
  |--- 0x09 FPGAå‡çº§ç»“æŸ -------------------->|
  |<-- 0x09 æ‰€æœ‰æ•°æ®åŒ…å‘é€æˆåŠŸ (FLAG=0x0E) ---|
  |                                          |
  |    ... (DSP1, DSP2, ARM åŒæ ·æµç¨‹)         |
  |                                          |
  |--- 0x10 æ€»ä½“ç»“æŸ ------------------------>|
  |<-- 0x10 å‘½ä»¤æ‰§è¡ŒæˆåŠŸ (FLAG=0x00) ---------|
  |                                          |
```

---

## æ•…éšœæŽ’æŸ¥

### å¸¸è§é—®é¢˜

| é—®é¢˜ | å¯èƒ½åŽŸå›  | è§£å†³æ–¹æ³• |
|------|---------|---------|
| ä¸²å£æ‰“å¼€å¤±è´¥ | ç«¯å£è¢«å ç”¨ | å…³é—­å…¶ä»–ä¸²å£å·¥å…·ï¼Œé‡æ–°æ’æ‹”è®¾å¤‡ |
| TCP è¿žæŽ¥è¶…æ—¶ | IP æˆ–ç«¯å£é”™è¯¯ | æ£€æŸ¥ IP é…ç½®ï¼Œä½¿ç”¨ `ping` æµ‹è¯• |
| CRC æ ¡éªŒå¤±è´¥ | é€šä¿¡å¹²æ‰°æˆ–æ•°æ®æŸå | é™ä½Žæ³¢ç‰¹çŽ‡ï¼Œå‡å°æ•°æ®åŒ…å¤§å° |
| å‡çº§è¶…æ—¶ | è®¾å¤‡å“åº”æ…¢æˆ–æœªå“åº” | æ£€æŸ¥è®¾å¤‡çŠ¶æ€ï¼Œé‡å¯è®¾å¤‡ |
| è½¯ä»¶æ— æ³•å¯åŠ¨ | è¯•ç”¨æœŸå·²è¿‡ | è”ç³»ä¾›åº”å•†èŽ·å–æ­£å¼ç‰ˆæœ¬ |

### è°ƒè¯•å»ºè®®
1. **å¯ç”¨æ—¥å¿—**ï¼šå‹¾é€‰æ—¥å¿—åŠŸèƒ½ï¼Œä¾¿äºŽäº‹åŽåˆ†æž
2. **é™ä½Žé€Ÿåº¦**ï¼šå‡å°æ•°æ®åŒ…å¤§å°ï¼ˆå¦‚ 512ï¼‰ï¼Œé™ä½Žä¼ è¾“é€ŸçŽ‡
3. **éš”ç¦»æµ‹è¯•**ï¼šå…ˆç”¨æµ‹è¯•è„šæœ¬éªŒè¯é€šä¿¡ï¼Œå†æµ‹è¯•çœŸå®žè®¾å¤‡
4. **æ£€æŸ¥ç¡¬ä»¶**ï¼šç¡®è®¤çº¿ç¼†è´¨é‡ã€æŽ¥å£ç‰¢å›ºã€ä¾›ç”µç¨³å®š

---

## å¼€å‘æŒ‡å—

### æ·»åŠ æ–°è®¾å¤‡ç±»åž‹
1. åœ¨ `protocol.h` ä¸­æ·»åŠ æ–°çš„æŠ¥æ–‡ç±»åž‹å¸¸é‡
2. åœ¨ `upgrade.cpp` ä¸­çš„è®¾å¤‡åˆ—è¡¨æ·»åŠ æ–°è®¾å¤‡
3. åœ¨ `mainwindow.ui` ä¸­æ·»åŠ å¯¹åº”çš„å¤é€‰æ¡†å’Œæ–‡ä»¶é€‰æ‹©æŽ§ä»¶
4. æ›´æ–°çŠ¶æ€æœºé€»è¾‘ï¼Œæ·»åŠ æ–°è®¾å¤‡çš„å‡çº§æµç¨‹

### ä¿®æ”¹é€šä¿¡å‚æ•°
- **ä¸²å£æ³¢ç‰¹çŽ‡**ï¼šä¿®æ”¹ `communication.cpp` ä¸­çš„ `openSerial()` å‡½æ•°
- **TCP ç«¯å£**ï¼šä¿®æ”¹ç•Œé¢é»˜è®¤å€¼å’Œ `openTcp()` å‡½æ•°
- **è¶…æ—¶æ—¶é—´**ï¼šä¿®æ”¹ `upgrade.cpp` ä¸­çš„è¶…æ—¶å®šæ—¶å™¨æ—¶é•¿

### æ‰©å±•åè®®
å¦‚éœ€æ”¯æŒæ–°çš„åº”ç­”æ ‡è¯†æˆ–æŠ¥æ–‡ç±»åž‹ï¼Œéœ€åŒæ­¥ä¿®æ”¹ï¼š
1. `protocol.h` - æ·»åŠ å¸¸é‡å®šä¹‰
2. `protocol.cpp` - æ›´æ–°æè¿°æ˜ å°„å‡½æ•°
3. `upgrade.cpp` - æ›´æ–°çŠ¶æ€æœºå¤„ç†é€»è¾‘

---

## æ³¨æ„äº‹é¡¹

âš ï¸ **é‡è¦æé†’**ï¼š
1. **å‡çº§é£Žé™©**ï¼šå›ºä»¶å‡çº§è¿‡ç¨‹ä¸­ä¸¥ç¦æ–­ç”µï¼Œå¯èƒ½å¯¼è‡´è®¾å¤‡æŸå
2. **å¤‡ä»½å›ºä»¶**ï¼šå‡çº§å‰å»ºè®®å¤‡ä»½åŽŸæœ‰å›ºä»¶ï¼ˆå¦‚æ”¯æŒï¼‰
3. **æ–‡ä»¶æ ¡éªŒ**ï¼šç¡®ä¿å›ºä»¶æ–‡ä»¶å®Œæ•´ä¸”ä¸Žè®¾å¤‡åž‹å·åŒ¹é…
4. **å•æ¬¡å‡çº§**ï¼šåŒä¸€æ—¶é—´åªå¯¹ä¸€ä¸ªè®¾å¤‡è¿›è¡Œå‡çº§æ“ä½œ

---

## ç‰ˆæœ¬åŽ†å²

### V1.0 (2025-10-22)
- âœ… åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- âœ… æ”¯æŒä¸²å£å’Œç½‘å£é€šä¿¡
- âœ… æ”¯æŒ FPGAã€DSP1ã€DSP2ã€ARM å››ç§è®¾å¤‡
- âœ… å®Œæ•´çš„ CRC16 æ ¡éªŒæœºåˆ¶
- âœ… è¯¦ç»†çš„æ—¥å¿—è®°å½•åŠŸèƒ½
- âœ… æ™ºèƒ½è¶…æ—¶å’Œé”™è¯¯å¤„ç†

---

## è®¸å¯è¯

æœ¬è½¯ä»¶ä¸ºä¸“æœ‰è½¯ä»¶ï¼Œå—ç‰ˆæƒä¿æŠ¤ã€‚ä»…ä¾›æŽˆæƒç”¨æˆ·ä½¿ç”¨ï¼Œç¦æ­¢æœªç»æŽˆæƒçš„å¤åˆ¶ã€åˆ†å‘æˆ–ä¿®æ”¹ã€‚

---

## è”ç³»æ–¹å¼

å¦‚æœ‰æŠ€æœ¯é—®é¢˜æˆ–éœ€è¦æ”¯æŒï¼Œè¯·è”ç³»æŠ€æœ¯æ”¯æŒå›¢é˜Ÿï¼Œå¹¶æä¾›ï¼š
- è½¯ä»¶ç‰ˆæœ¬å’Œæž„å»ºæ—¥æœŸ
- è®¾å¤‡åž‹å·å’Œå›ºä»¶ä¿¡æ¯
- æ—¥å¿—æ–‡ä»¶ (`bootloader.log`)
- è¯¦ç»†çš„é”™è¯¯æè¿°å’Œæˆªå›¾

---

**Â© 2025 BootLoader é¡¹ç›®ç»„ | ä¿ç•™æ‰€æœ‰æƒåˆ©**